<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Costos de C치maras de Seguridad V4.0</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; background-color: #f0f2f5; margin: 0; padding: 20px; }
        h1, h2 { color: #333; text-align: center; }
        #main-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; width: 100%; max-width: 1600px; }
        #controls-container { flex-basis: 100%; text-align: center; margin-bottom: 10px; background-color: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        #controls-container button { background-color: #007bff; color: white; border: none; padding: 10px 20px; font-size: 16px; cursor: pointer; border-radius: 5px; margin: 0 10px; }
        #controls-container button:hover { background-color: #0056b3; }
        #svg-container { border: 1px solid #ccc; background-color: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.1); flex-basis: 65%; min-width: 600px; }
        #info-container { flex-basis: 30%; min-width: 350px; background-color: #fff; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 14px; }
        th { background-color: #f2f2f2; }
        tfoot td { font-weight: bold; font-size: 16px; color: #d32f2f; }
        #cable-breakdown { margin-top: 15px; font-size: 12px; }
        #cable-breakdown h3 { margin-bottom: 5px; }
        #cable-breakdown div { padding: 2px 0; }
        .building { fill: #ff9800; stroke: #c66900; stroke-width: 1; }
        .patio { fill: #9e9e9e; stroke: #707070; stroke-width: 1; }
        .cancha { fill: #bdbdbd; stroke: #8d8d8d; stroke-width: 1; }
        .cooperativa { fill: #4caf50; stroke: #388e3c; stroke-width: 1; }
        .bodeguita { fill: #ff9800; stroke: #c66900; opacity: 0.7;}
        .perimeter { fill: #f5f5f5; stroke: #333; stroke-width: 2; }
        .text-label { font-size: 12px; font-family: sans-serif; fill: #000; pointer-events: none; }
        .dvr-label { font-size: 14px; font-weight: bold; fill: #c0392b; }
        .camera-group.dragging { opacity: 0.7; }
        .camera-icon { font-size: 24px; cursor: grab; text-anchor: middle; dominant-baseline: middle; }
        .camera-icon:active { cursor: grabbing; }
        .camera-label { font-size: 14px; font-weight: bold; fill: #cc0000; pointer-events: none; }
        .vision-cone { fill: #03a9f4; fill-opacity: 0.4; stroke: #0288d1; stroke-width: 1; pointer-events: none; }
        .cable-line { stroke: #d32f2f; stroke-width: 1.5; stroke-dasharray: 5,5; pointer-events: none; }
        .cable-label { font-size: 12px; fill: #d32f2f; font-weight: bold; pointer-events: none; }
    </style>
</head>
<body>
    <h1>Simulador Interactivo de C치maras (V4.0)</h1>
    <div id="controls-container">
        <button id="add-wired-cam">A침adir Al치mbrica (游꿘)</button>
        <button id="add-wireless-cam">A침adir Inal치mbrica (游니)</button>
    </div>
    <div id="main-container">
        <div id="svg-container">
            <svg id="plano-escuela" width="100%" viewBox="0 0 1000 650">
                <!-- Per칤metro Corregido Definitivo (5 V칠rtices) -->
                <polygon class="perimeter" points="150,100 500,50 950,150 800,600 100,500" />

                <!-- Edificios y 츼reas Reubicados -->
                <rect x="550,200" width="247" height="119" class="building" /><text x="610,250" class="text-label">Edificio Director</text>
                <text x="570,270" class="dvr-label">DVR</text>
                <rect x="500,380" width="255" height="111" class="building" /><text x="560,420" class="text-label">Edificio Secretaria</text>
                <rect x="350,220" width="150" height="120" class="patio" /><text x="400,280" class="text-label">Patios</text>
                <rect x="250,350" width="180" height="100" class="cancha" /><text x="280,390" class="text-label">Cancha</text>
                <rect x="150,400" width="60" height="40" class="bodeguita" /><text x="155,425" class="text-label">Bodeguita</text>
                <rect x="900,160" width="40" height="40" class="cooperativa" /><text x="910,215" class="text-label">Acceso</text>
                <polygon class="cooperativa" points="760,500 800,550 740,560" /><text x="730,580" class="text-label">Cooperativa</text>

                <g id="cables-group"></g>
                <g id="cameras-group"></g>
            </svg>
        </div>
        <div id="info-container">
            <h2>Estimaci칩n de Presupuesto</h2>
            <table id="costs-table">
                <thead><tr><th>Concepto</th><th>Costo (MXN)</th></tr></thead>
                <tbody>
                    <tr><td>Kit Base (DVR, HDD 1TB)</td><td id="cost-kit-base"></td></tr>
                    <tr><td>C치maras Al치mbricas</td><td id="cost-wired-cams"></td></tr>
                    <tr><td>C치maras Inal치mbricas</td><td id="cost-wireless-cams"></td></tr>
                    <tr><td>Cable Adicional (Metros)</td><td id="cost-cable"></td></tr>
                    <tr><td>Conectores (BNC y DC)</td><td id="cost-connectors"></td></tr>
                    <tr><td>Eliminadores (Inal치mbricas)</td><td id="cost-power-adapters"></td></tr>
                    <tr><td>Fuente de Poder Centralizada</td><td id="cost-power-supply"></td></tr>
                    <tr><td>Instalaci칩n y Mano de Obra</td><td id="cost-labor"></td></tr>
                    <tr><td>Configuraci칩n Inicial</td><td id="cost-setup"></td></tr>
                </tbody>
                <tfoot><tr><td>TOTAL ESTIMADO</td><td id="cost-total"></td></tr></tfoot>
            </table>
            <div id="cable-breakdown">
                <h3>Desglose de Cableado por C치mara</h3>
                <div id="breakdown-list"></div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const svg = document.getElementById('plano-escuela');
        const camerasGroup = document.getElementById('cameras-group');
        const cablesGroup = document.getElementById('cables-group');

        let cameras = [];
        let nextCamId = 1;
        const DVR_POSITION = { x: 570, y: 270 };
        const PIXELS_TO_METERS = 0.1;
        const CABLE_IN_KIT = 18;

        const COSTS = { kitBase: 3500, wiredCam: 500, wirelessCam: 750, cablePerMeter: 8.20, connectorsPerCam: 100, powerAdapter: 150, powerSupply: 850, laborPerCam: 750, setup: 1000 };

        let selectedElement = null, offset;

        const getMousePosition = (evt) => {
            const CTM = svg.getScreenCTM();
            return { x: (evt.clientX - CTM.e) / CTM.a, y: (evt.clientY - CTM.f) / CTM.d };
        };

        const startDrag = (evt) => {
            if (evt.target.classList.contains('camera-icon')) {
                selectedElement = evt.target.parentNode;
                selectedElement.classList.add('dragging');
                offset = getMousePosition(evt);
                const camData = cameras.find(c => c.id == selectedElement.dataset.id);
                offset.x -= camData.x;
                offset.y -= camData.y;
            }
        };

        const drag = (evt) => {
            if (selectedElement) {
                evt.preventDefault();
                const coord = getMousePosition(evt);
                const camData = cameras.find(c => c.id == selectedElement.dataset.id);
                camData.x = coord.x - offset.x;
                camData.y = coord.y - offset.y;
                render();
            }
        };

        const endDrag = () => {
            if (selectedElement) {
                selectedElement.classList.remove('dragging');
                selectedElement = null;
            }
        };

        svg.addEventListener('mousedown', startDrag);
        svg.addEventListener('mousemove', drag);
        svg.addEventListener('mouseup', endDrag);
        svg.addEventListener('mouseleave', endDrag);

        const addCamera = (type) => {
            cameras.push({ id: nextCamId++, type, x: 200 + (nextCamId * 20), y: 100, angle: 0 });
            render();
        };

        document.getElementById('add-wired-cam').addEventListener('click', () => addCamera('wired'));
        document.getElementById('add-wireless-cam').addEventListener('click', () => addCamera('wireless'));

        const render = () => {
            camerasGroup.innerHTML = '';
            cablesGroup.innerHTML = '';
            const visionAngle = 110, visionRadius = 150;
            const toRadians = (d) => d * Math.PI / 180;

            cameras.forEach(cam => {
                const camGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g' );
                camGroup.setAttribute('class', 'camera-group');
                camGroup.dataset.id = cam.id;

                const [sa, ea] = [toRadians(cam.angle - visionAngle / 2), toRadians(cam.angle + visionAngle / 2)];
                const [x1, y1] = [cam.x + visionRadius * Math.cos(sa), cam.y + visionRadius * Math.sin(sa)];
                const [x2, y2] = [cam.x + visionRadius * Math.cos(ea), cam.y + visionRadius * Math.sin(ea)];

                const cone = document.createElementNS('http://www.w3.org/2000/svg', 'path' );
                cone.setAttribute('d', `M ${cam.x} ${cam.y} L ${x1} ${y1} A ${visionRadius} ${visionRadius} 0 0 1 ${x2} ${y2} Z`);
                cone.setAttribute('class', 'vision-cone');
                camGroup.appendChild(cone);

                const icon = document.createElementNS('http://www.w3.org/2000/svg', 'text' );
                icon.setAttribute('x', cam.x);
                icon.setAttribute('y', cam.y);
                icon.setAttribute('class', 'camera-icon');
                icon.textContent = cam.type === 'wired' ? '游꿘' : '游니';
                camGroup.appendChild(icon);

                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text' );
                label.setAttribute('x', cam.x + 20);
                label.setAttribute('y', cam.y - 20);
                label.setAttribute('class', 'camera-label');
                label.textContent = cam.id;
                camGroup.appendChild(label);
                camerasGroup.appendChild(camGroup);

                if (cam.type === 'wired') {
                    const cableLine = document.createElementNS('http://www.w3.org/2000/svg', 'line' );
                    cableLine.setAttribute('x1', cam.x);
                    cableLine.setAttribute('y1', cam.y);
                    cableLine.setAttribute('x2', DVR_POSITION.x);
                    cableLine.setAttribute('y2', DVR_POSITION.y);
                    cableLine.setAttribute('class', 'cable-line');
                    cablesGroup.appendChild(cableLine);

                    const distanceInMeters = Math.sqrt(Math.pow(cam.x - DVR_POSITION.x, 2) + Math.pow(cam.y - DVR_POSITION.y, 2)) * PIXELS_TO_METERS;
                    const cableLabel = document.createElementNS('http://www.w3.org/2000/svg', 'text' );
                    cableLabel.setAttribute('x', (cam.x + DVR_POSITION.x) / 2);
                    cableLabel.setAttribute('y', (cam.y + DVR_POSITION.y) / 2);
                    cableLabel.setAttribute('class', 'cable-label');
                    cableLabel.textContent = `${distanceInMeters.toFixed(1)}m`;
                    cablesGroup.appendChild(cableLabel);
                }
            });
            updateCosts();
        };

        const updateCosts = () => {
            let wiredCamsCost = 0, wirelessCamsCost = 0, extraCableMeters = 0;
            let wiredCamCount = 0, wirelessCamCount = 0;
            let breakdownHTML = '';

            cameras.forEach(cam => {
                if (cam.type === 'wired') {
                    wiredCamCount++;
                    wiredCamsCost += COSTS.wiredCam;
                    const distanceInMeters = Math.sqrt(Math.pow(cam.x - DVR_POSITION.x, 2) + Math.pow(cam.y - DVR_POSITION.y, 2)) * PIXELS_TO_METERS;
                    extraCableMeters += Math.max(0, distanceInMeters - CABLE_IN_KIT);
                    breakdownHTML += `<div>C치mara #${cam.id} (游꿘): ${distanceInMeters.toFixed(1)} metros</div>`;
                } else {
                    wirelessCamCount++;
                    wirelessCamsCost += COSTS.wirelessCam;
                }
            });

            const cableCost = extraCableMeters * COSTS.cablePerMeter;
            const connectorsCost = wiredCamCount * COSTS.connectorsPerCam;
            const powerAdaptersCost = wirelessCamCount * COSTS.powerAdapter;
            const laborCost = (wiredCamCount + wirelessCamCount) * COSTS.laborPerCam;
            const totalCost = COSTS.kitBase + wiredCamsCost + wirelessCamsCost + cableCost + connectorsCost + powerAdaptersCost + COSTS.powerSupply + laborCost + COSTS.setup;

            document.getElementById('cost-kit-base').textContent = `$${COSTS.kitBase.toFixed(2)}`;
            document.getElementById('cost-wired-cams').textContent = `$${wiredCamsCost.toFixed(2)} (${wiredCamCount} uds)`;
            document.getElementById('cost-wireless-cams').textContent = `$${wirelessCamsCost.toFixed(2)} (${wirelessCamCount} uds)`;
            document.getElementById('cost-cable').textContent = `$${cableCost.toFixed(2)} (${extraCableMeters.toFixed(0)} mts)`;
            document.getElementById('cost-connectors').textContent = `$${connectorsCost.toFixed(2)}`;
            document.getElementById('cost-power-adapters').textContent = `$${powerAdaptersCost.toFixed(2)}`;
            document.getElementById('cost-power-supply').textContent = `$${COSTS.powerSupply.toFixed(2)}`;
            document.getElementById('cost-labor').textContent = `$${laborCost.toFixed(2)}`;
            document.getElementById('cost-setup').textContent = `$${COSTS.setup.toFixed(2)}`;
            document.getElementById('cost-total').textContent = `$${totalCost.toFixed(2)}`;
            document.getElementById('breakdown-list').innerHTML = breakdownHTML;
        };

        addCamera('wired');
        addCamera('wired');
    });
    </script>
</body>
</html>

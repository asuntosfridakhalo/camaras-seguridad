<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Costos de C치maras de Seguridad V3.0</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; background-color: #f0f2f5; margin: 0; padding: 20px; }
        h1, h2 { color: #333; text-align: center; }
        #main-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; width: 100%; max-width: 1600px; }
        #controls-container { flex-basis: 100%; text-align: center; margin-bottom: 10px; }
        #controls-container button { background-color: #4CAF50; color: white; border: none; padding: 10px 20px; font-size: 16px; cursor: pointer; border-radius: 5px; margin: 0 10px; }
        #controls-container button:hover { background-color: #45a049; }
        #svg-container { border: 1px solid #ccc; background-color: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.1); flex-basis: 65%; min-width: 600px; }
        #info-container { flex-basis: 30%; min-width: 350px; background-color: #fff; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 14px; }
        th { background-color: #f2f2f2; }
        tfoot td { font-weight: bold; font-size: 16px; color: #d32f2f; }
        .building { fill: #ff9800; stroke: #c66900; stroke-width: 1; }
        .patio { fill: #9e9e9e; stroke: #707070; stroke-width: 1; }
        .cancha { fill: #bdbdbd; stroke: #8d8d8d; stroke-width: 1; }
        .cooperativa { fill: #4caf50; stroke: #388e3c; stroke-width: 1; }
        .bodeguita { fill: #ff9800; stroke: #c66900; opacity: 0.7;}
        .perimeter { fill: #f5f5f5; stroke: #333; stroke-width: 2; }
        .text-label { font-size: 12px; font-family: sans-serif; fill: #000; pointer-events: none; }
        .dvr-label { font-size: 12px; font-weight: bold; fill: #c0392b; }
        .camera-group.dragging { opacity: 0.7; }
        .camera-icon { font-size: 24px; cursor: grab; text-anchor: middle; dominant-baseline: middle; }
        .camera-icon:active { cursor: grabbing; }
        .camera-label { font-size: 14px; font-weight: bold; fill: #cc0000; pointer-events: none; }
        .vision-cone { fill: #03a9f4; fill-opacity: 0.4; stroke: #0288d1; stroke-width: 1; pointer-events: none; }
    </style>
</head>
<body>
    <h1>Simulador Interactivo de C치maras (V3.0)</h1>
    <div id="controls-container">
        <button id="add-wired-cam">A침adir C치mara Al치mbrica (游꿘)</button>
        <button id="add-wireless-cam">A침adir C치mara Inal치mbrica (游니)</button>
    </div>
    <div id="main-container">
        <div id="svg-container">
            <svg id="plano-escuela" width="100%" viewBox="0 0 1000 650">
                <!-- Per칤metro Corregido Definitivo -->
                <polygon class="perimeter" points="150,50 500,20 900,150 800,600 100,500" />

                <!-- Edificios y 츼reas -->
                <rect x="550" y="200" width="247" height="119" class="building" />
                <text x="610" y="250" class="text-label">Edificio de aulas y</text>
                <text x="610" y="265" class="text-label">oficina del director</text>
                <text x="570" y="270" class="dvr-label">DVR</text>

                <rect x="500" y="380" width="255" height="111" class="building" />
                <text x="560" y="420" class="text-label">Edificio de aulas y</text>
                <text x="560" y="435" class="text-label">oficina de la secretaria</text>
                
                <rect x="350" y="220" width="150" height="120" class="patio" /><text x="400" y="280" class="text-label">Patios</text>
                <rect x="250" y="350" width="180" height="100" class="cancha" /><text x="280" y="390" class="text-label">Cancha</text>
                <rect x="150" y="400" width="60" height="40" class="bodeguita" /><text x="155" y="425" class="text-label">Bodeguita</text>
                <rect x="850" y="160" width="40" height="40" class="cooperativa" /><text x="860" y="215" class="text-label">Acceso</text>
                
                <!-- Cooperativa Triangular -->
                <polygon class="cooperativa" points="760,500 800,550 740,560" /><text x="730" y="580" class="text-label">Cooperativa</text>

                <g id="cameras-group"></g>
            </svg>
        </div>
        <div id="info-container">
            <h2>Estimaci칩n de Presupuesto</h2>
            <table id="costs-table">
                <thead>
                    <tr><th>Concepto</th><th>Costo (MXN)</th></tr>
                </thead>
                <tbody>
                    <tr><td>Kit Base (DVR, HDD 1TB)</td><td id="cost-kit-base">$3,500</td></tr>
                    <tr><td>C치maras Al치mbricas</td><td id="cost-wired-cams">$0</td></tr>
                    <tr><td>C치maras Inal치mbricas</td><td id="cost-wireless-cams">$0</td></tr>
                    <tr><td>Cable Adicional (Metros)</td><td id="cost-cable">$0</td></tr>
                    <tr><td>Conectores (BNC y DC)</td><td id="cost-connectors">$0</td></tr>
                    <tr><td>Eliminadores (Inal치mbricas)</td><td id="cost-power-adapters">$0</td></tr>
                    <tr><td>Fuente de Poder Centralizada</td><td id="cost-power-supply">$850</td></tr>
                    <tr><td>Instalaci칩n y Mano de Obra</td><td id="cost-labor">$0</td></tr>
                    <tr><td>Configuraci칩n Inicial</td><td id="cost-setup">$1,000</td></tr>
                </tbody>
                <tfoot>
                    <tr><td>TOTAL ESTIMADO</td><td id="cost-total">$0</td></tr>
                </tfoot>
            </table>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const svg = document.getElementById('plano-escuela');
        const group = document.getElementById('cameras-group');
        const svgPoint = svg.createSVGPoint();

        // --- DATOS Y COSTOS BASE ---
        let cameras = [];
        let nextCamId = 1;
        const DVR_POSITION = { x: 570, y: 270 };
        const PIXELS_TO_METERS = 0.1; // Factor de conversi칩n: 10px = 1 metro
        const CABLE_IN_KIT = 18; // Metros de cable por c치mara en el kit

        const COSTS = {
            kitBase: 3500,
            wiredCam: 500,
            wirelessCam: 750,
            cablePerMeter: 8.20,
            connectorsPerCam: 100,
            powerAdapter: 150,
            powerSupply: 850,
            laborPerCam: 750,
            setup: 1000
        };

        // --- L칍GICA DE DRAG AND DROP ---
        let selectedElement = null;
        let offset;

        function getMousePosition(evt) {
            const CTM = svg.getScreenCTM();
            return {
                x: (evt.clientX - CTM.e) / CTM.a,
                y: (evt.clientY - CTM.f) / CTM.d
            };
        }

        function startDrag(evt) {
            if (evt.target.classList.contains('camera-icon')) {
                selectedElement = evt.target.parentNode;
                selectedElement.classList.add('dragging');
                offset = getMousePosition(evt);
                const camData = cameras.find(c => c.id == selectedElement.dataset.id);
                offset.x -= camData.x;
                offset.y -= camData.y;
            }
        }

        function drag(evt) {
            if (selectedElement) {
                evt.preventDefault();
                const coord = getMousePosition(evt);
                const newX = coord.x - offset.x;
                const newY = coord.y - offset.y;
                
                const camData = cameras.find(c => c.id == selectedElement.dataset.id);
                camData.x = newX;
                camData.y = newY;
                
                renderCameras();
            }
        }

        function endDrag(evt) {
            if (selectedElement) {
                selectedElement.classList.remove('dragging');
                selectedElement = null;
                updateCosts();
            }
        }

        svg.addEventListener('mousedown', startDrag);
        svg.addEventListener('mousemove', drag);
        svg.addEventListener('mouseup', endDrag);
        svg.addEventListener('mouseleave', endDrag);

        // --- L칍GICA DE C츼MARAS Y RENDERIZADO ---
        function addCamera(type) {
            const newCam = {
                id: nextCamId++,
                type: type,
                x: 200 + (nextCamId * 20),
                y: 100,
                angle: 0
            };
            cameras.push(newCam);
            renderCameras();
            updateCosts();
        }

        document.getElementById('add-wired-cam').addEventListener('click', () => addCamera('wired'));
        document.getElementById('add-wireless-cam').addEventListener('click', () => addCamera('wireless'));

        function renderCameras() {
            group.innerHTML = ''; // Limpiar antes de volver a dibujar
            const visionAngle = 110;
            const visionRadius = 150;
            const toRadians = (degrees) => degrees * Math.PI / 180;

            cameras.forEach(cam => {
                const camGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g' );
                camGroup.setAttribute('class', 'camera-group');
                camGroup.dataset.id = cam.id;

                const startAngle = toRadians(cam.angle - visionAngle / 2);
                const endAngle = toRadians(cam.angle + visionAngle / 2);
                const x1 = cam.x + visionRadius * Math.cos(startAngle);
                const y1 = cam.y + visionRadius * Math.sin(startAngle);
                const x2 = cam.x + visionRadius * Math.cos(endAngle);
                const y2 = cam.y + visionRadius * Math.sin(endAngle);

                const cone = document.createElementNS('http://www.w3.org/2000/svg', 'path' );
                cone.setAttribute('d', `M ${cam.x} ${cam.y} L ${x1} ${y1} A ${visionRadius} ${visionRadius} 0 0 1 ${x2} ${y2} Z`);
                cone.setAttribute('class', 'vision-cone');
                camGroup.appendChild(cone);

                const icon = document.createElementNS('http://www.w3.org/2000/svg', 'text' );
                icon.setAttribute('x', cam.x);
                icon.setAttribute('y', cam.y);
                icon.setAttribute('class', 'camera-icon');
                icon.textContent = cam.type === 'wired' ? '游꿘' : '游니';
                camGroup.appendChild(icon);

                const label = document.createElementNS('http://www.w3.org/2000/svg', 'text' );
                label.setAttribute('x', cam.x + 20);
                label.setAttribute('y', cam.y - 20);
                label.setAttribute('class', 'camera-label');
                label.textContent = cam.id;
                camGroup.appendChild(label);
                
                group.appendChild(camGroup);
            });
        }

        // --- L칍GICA DE C츼LCULO DE COSTOS ---
        function updateCosts() {
            let totalWiredCamsCost = 0;
            let totalWirelessCamsCost = 0;
            let totalExtraCableMeters = 0;
            let wiredCamCount = 0;
            let wirelessCamCount = 0;

            cameras.forEach(cam => {
                if (cam.type === 'wired') {
                    wiredCamCount++;
                    totalWiredCamsCost += COSTS.wiredCam;
                    const distanceInPixels = Math.sqrt(Math.pow(cam.x - DVR_POSITION.x, 2) + Math.pow(cam.y - DVR_POSITION.y, 2));
                    const distanceInMeters = distanceInPixels * PIXELS_TO_METERS;
                    const extraCable = Math.max(0, distanceInMeters - CABLE_IN_KIT);
                    totalExtraCableMeters += extraCable;
                } else { // wireless
                    wirelessCamCount++;
                    totalWirelessCamsCost += COSTS.wirelessCam;
                }
            });

            const cableCost = totalExtraCableMeters * COSTS.cablePerMeter;
            const connectorsCost = wiredCamCount * COSTS.connectorsPerCam;
            const powerAdaptersCost = wirelessCamCount * COSTS.powerAdapter;
            const laborCost = (wiredCamCount + wirelessCamCount) * COSTS.laborPerCam;
            
            const totalCost = COSTS.kitBase + totalWiredCamsCost + totalWirelessCamsCost + cableCost + connectorsCost + powerAdaptersCost + COSTS.powerSupply + laborCost + COSTS.setup;

            // Actualizar la tabla
            document.getElementById('cost-kit-base').textContent = `$${COSTS.kitBase.toFixed(2)}`;
            document.getElementById('cost-wired-cams').textContent = `$${totalWiredCamsCost.toFixed(2)} (${wiredCamCount} uds)`;
            document.getElementById('cost-wireless-cams').textContent = `$${totalWirelessCamsCost.toFixed(2)} (${wirelessCamCount} uds)`;
            document.getElementById('cost-cable').textContent = `$${cableCost.toFixed(2)} (${totalExtraCableMeters.toFixed(0)} mts)`;
            document.getElementById('cost-connectors').textContent = `$${connectorsCost.toFixed(2)}`;
            document.getElementById('cost-power-adapters').textContent = `$${powerAdaptersCost.toFixed(2)}`;
            document.getElementById('cost-power-supply').textContent = `$${COSTS.powerSupply.toFixed(2)}`;
            document.getElementById('cost-labor').textContent = `$${laborCost.toFixed(2)}`;
            document.getElementById('cost-setup').textContent = `$${COSTS.setup.toFixed(2)}`;
            document.getElementById('cost-total').textContent = `$${totalCost.toFixed(2)}`;
        }

        // Inicializar con algunas c치maras de ejemplo
        addCamera('wired');
        addCamera('wired');
        updateCosts();
    });
    </script>
</body>
</html>
